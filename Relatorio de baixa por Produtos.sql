-- Vers√£o com inner join no SD2

SELECT
	E1.R_E_C_N_O_ AS E1_REC,
	E5.R_E_C_N_O_ AS E5_REC,
	D2.R_E_C_N_O_ AS D2_REC,
	E1.E1_FILORIG AS FILIAL,
	A1.A1_COD AS CLI_COD,
	A1.A1_LOJA AS LOJA,
	A1.A1_NOME AS CLI_NOME,
	E1.E1_PREFIXO AS PREFIXO,
	E1.E1_NUM AS DOCUMENTO, 
	E1.E1_PARCELA AS PARCELA, 
	E1.E1_TIPO AS TIPO, 
	E1.E1_NATUREZ AS NATUREZA,
	E1.E1_EMISSAO AS EMISSAO,
	E1.E1_VENCTO AS VENCIMENTO,
	E1.E1_VENCREA AS VENC_REAL,
	E1_NUMBCO AS BANCO, 
	E1.E1_SITUACA AS ST,
	E1.E1_VALOR AS VALOR, 
	'' AS VL_ORIG,
	'' AS VL_NOMINAL, 
	'' AS VL_CORRIG, 
	'' AS VL_VENCIDO,
	'' AS VL_JUROS,
	'' AS ATRASO,
	E1.E1_SALDO AS SALDO,
	E1.E1_BAIXA AS DATA_BAIXA,
	E5.E5_DATA AS DATA_MOV,
	E5.E5_VALOR AS VALOR_MOV,
	E5.E5_BANCO AS BANCO_MOV,
	E5.E5_AGENCIA AS AGENCIA_MOV,
	E5.E5_CONTA AS CONTA_MOV,
	E5.E5_DOCUMEN AS DOC_MOV,
	E5.E5_MOTBX AS MOTV_BAIXA,
	D2.D2_ITEM AS ITEM, 
	D2.D2_COD AS PROD_COD,
	B1.B1_DESC AS PROD_DESCRI,
	D2.D2_QUANT AS QUANTIDADE, 
	D2.D2_UM AS UNIDADE, 
	D2.D2_PRCVEN AS PRC_UNIT, 
	D2.D2_TOTAL AS PRC_ITEM, 
	CASE
		WHEN
			D2.D2_QUANT * D2.D2_PRCVEN = D2.D2_TOTAL 
		THEN
			'ok' 
		ELSE
			'ERR' 
	END
	AS MULTIPLI_OK, 
	A3.A3_COD AS VEND_COD,
	A3.A3_NOME AS VEND_NOME,
	A3.A3_REGIAO AS VEND_REGI,
	A3.A3_GEREN AS VEND_GER
FROM
	SE1010 E1 
	INNER JOIN
		SD2010 D2 
		ON E1.E1_TIPO = 'NF' 
		AND E1.E1_NUM = D2.D2_DOC
		AND E1.E1_FILORIG = D2.D2_FILIAL 
		AND D2.D_E_L_E_T_ = '' 
	INNER JOIN
		SA1010 A1 
		ON E1.E1_CLIENTE = A1.A1_COD 
		AND E1.E1_LOJA = A1.A1_LOJA
		AND A1.D_E_L_E_T_ = '' 
	INNER JOIN
		SB1010 B1
		ON D2.D2_COD = B1.B1_COD
		AND B1.D_E_L_E_T_ = '' 
	INNER JOIN 
		SA3010 A3
		ON E1.E1_VEND1 = A3.A3_COD
		AND A3.D_E_L_E_T_ = ''
	LEFT JOIN
		SE5010 E5
		ON E1.E1_PREFIXO = E5.E5_PREFIXO
		AND E1.E1_NUM = E5.E5_NUMERO
		AND E1.E1_PARCELA = E5.E5_PARCELA
		AND E1.E1_TIPO = E5.E5_TIPO
		AND E1.E1_CLIENTE = E5.E5_CLIENTE
		AND E1.E1_LOJA = E5.E5_LOJA
		AND E1.E1_FILIAL = E5.E5_FILIAL
		AND E5.D_E_L_E_T_ = ''
WHERE
	E1.E1_FILORIG IN ('FG01')
	AND E1.E1_CLIENTE || '-' || E1.E1_LOJA IN ('084500310-0001', '000516169-0001', '004142810-0001', '103333160-0001', '445932640-0001', '220554560-0001', '204771690-0001', '005189690-0001', '042827500-0001')
	AND E1.E1_SITUACA IN ('0', '1', '2', '3', '4', '5', '6', '7', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O')
	AND E1.E1_SALDO <> 0
	AND E1.D_E_L_E_T_ = '' 
ORDER BY
	CLI_NOME, LOJA, DOCUMENTO, PARCELA, ITEM;

-- Diamante

SELECT 
	REL.*
FROM 
	(SELECT
		*
	FROM 
		(SELECT
			E1.R_E_C_N_O_ AS E1_REC,
			E5.R_E_C_N_O_ AS E5_REC,
			0 AS D2_REC,
			E1.E1_FILORIG AS FILIAL,
			A1.A1_COD AS CLI_COD,
			A1.A1_LOJA AS LOJA,
			A1.A1_NOME AS CLI_NOME,
			E1.E1_PREFIXO AS PREFIXO,
			'' AS SERIE, 
			E1.E1_NUM AS DOCUMENTO, 
			E1.E1_PARCELA AS PARCELA, 
			'' AS ITEM, 
			E1.E1_TIPO AS TIPO, 
			E1.E1_NATUREZ AS NATUREZA,
			E1.E1_EMISSAO AS EMISSAO,
			E1.E1_VENCTO AS VENCIMENTO,
			E1.E1_VENCREA AS VENC_REAL,
			E1_NUMBCO AS BANCO, 
			E1.E1_SITUACA AS ST,
			E1.E1_VALOR AS VALOR, 
			'' AS VL_ORIG,
			'' AS VL_NOMINAL, 
			'' AS VL_CORRIG, 
			'' AS VL_VENCIDO,
			'' AS VL_JUROS,
			'' AS ATRASO,
			E1.E1_SALDO AS SALDO,
			E1.E1_BAIXA AS ULTIMA_BAIXA,
			E5.E5_DATA AS DATA_MOV,
			E5.E5_VALOR AS VALOR_MOV,
			E5.E5_BANCO AS BANCO_MOV,
			E5.E5_AGENCIA AS AGENCIA_MOV,
			E5.E5_CONTA AS CONTA_MOV,
			E5.E5_DOCUMEN AS DOC_MOV,
			E5.E5_MOTBX AS MOTV_BAIXA,
			'' AS PROD_COD,
			'' AS PROD_DESCRI,
			0 AS QUANTIDADE, 
			'' AS UNIDADE, 
			0 AS PRC_UNIT, 
			0 AS PRC_ITEM, 
			'' AS MULTIPLI_OK, 
			A3.A3_COD AS VEND_COD,
			A3.A3_NOME AS VEND_NOME,
			A3.A3_REGIAO AS VEND_REGI,
			A3.A3_GEREN AS VEND_GER
		FROM
			SE1010 E1 
			INNER JOIN
				SA1010 A1 
				ON E1.E1_CLIENTE = A1.A1_COD 
				AND E1.E1_LOJA = A1.A1_LOJA
				AND A1.D_E_L_E_T_ = '' 
			INNER JOIN 
				SA3010 A3
				ON E1.E1_VEND1 = A3.A3_COD
				AND A3.D_E_L_E_T_ = ''
			LEFT JOIN
				SE5010 E5
				ON E1.E1_FILORIG = E5.E5_FILORIG
				AND E1.E1_PREFIXO = E5.E5_PREFIXO
				AND E1.E1_NUM = E5.E5_NUMERO
				AND E1.E1_PARCELA = E5.E5_PARCELA
				AND E1.E1_TIPO = E5.E5_TIPO
				AND E1.E1_CLIENTE = E5.E5_CLIENTE
				AND E1.E1_LOJA = E5.E5_LOJA
				AND E1.E1_FILIAL = E5.E5_FILIAL
				AND E5.D_E_L_E_T_ = ''
		WHERE
			E1.E1_TIPO = 'NF' 
			AND E1.E1_FILORIG IN ('FG01')
			AND E1.E1_CLIENTE || '-' || E1.E1_LOJA IN ('084500310-0001', '000516169-0001', '004142810-0001', '103333160-0001', '445932640-0001', '220554560-0001', '204771690-0001', '005189690-0001', '042827500-0001')
			AND E1.E1_SITUACA IN ('0', '1', '2', '3', '4', '5', '6', '7', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O')
			AND E1.E1_SALDO <> 0
			AND E1.D_E_L_E_T_ = '') RELE5
	UNION
	SELECT
		*
	FROM
		(SELECT
			E1.R_E_C_N_O_ AS E1_REC,
			0 AS E5_REC,
			D2.R_E_C_N_O_ AS D2_REC,
			E1.E1_FILORIG AS FILIAL,
			A1.A1_COD AS CLI_COD,
			A1.A1_LOJA AS LOJA,
			A1.A1_NOME AS CLI_NOME,
			E1.E1_PREFIXO AS PREFIXO,
			D2.D2_SERIE AS SERIE, 
			E1.E1_NUM AS DOCUMENTO, 
			E1.E1_PARCELA AS PARCELA, 
			D2.D2_ITEM AS ITEM, 
			E1.E1_TIPO AS TIPO, 
			E1.E1_NATUREZ AS NATUREZA,
			E1.E1_EMISSAO AS EMISSAO,
			E1.E1_VENCTO AS VENCIMENTO,
			E1.E1_VENCREA AS VENC_REAL,
			E1_NUMBCO AS BANCO, 
			E1.E1_SITUACA AS ST,
			0 AS VALOR, 
			'' AS VL_ORIG,
			'' AS VL_NOMINAL, 
			'' AS VL_CORRIG, 
			'' AS VL_VENCIDO,
			'' AS VL_JUROS,
			'' AS ATRASO,
			0 AS SALDO,
			E1.E1_BAIXA AS ULTIMA_BAIXA,
			'' AS DATA_MOV,
			0 AS VALOR_MOV,
			'' AS BANCO_MOV,
			'' AS AGENCIA_MOV,
			'' AS CONTA_MOV,
			'' AS DOC_MOV,
			'' AS MOTV_BAIXA,
			D2.D2_COD AS PROD_COD,
			B1.B1_DESC AS PROD_DESCRI,
			D2.D2_QUANT AS QUANTIDADE, 
			D2.D2_UM AS UNIDADE, 
			D2.D2_PRCVEN AS PRC_UNIT, 
			D2.D2_TOTAL AS PRC_ITEM, 
			CASE
				WHEN
					D2.D2_QUANT * D2.D2_PRCVEN = D2.D2_TOTAL 
				THEN
					'ok' 
				ELSE
					'ERR' 
			END
			AS MULTIPLI_OK, 
			'' AS VEND_COD,
			'' AS VEND_NOME,
			'' AS VEND_REGI,
			'' AS VEND_GER
		FROM
			SE1010 E1 
			INNER JOIN
				SA1010 A1 
				ON E1.E1_CLIENTE = A1.A1_COD 
				AND E1.E1_LOJA = A1.A1_LOJA
				AND A1.D_E_L_E_T_ = '' 
			INNER JOIN
				SD2010 D2 
				ON E1.E1_NUM = D2.D2_DOC
				AND E1.E1_FILORIG = D2.D2_FILIAL 
				AND E1.E1_CLIENTE = D2.D2_CLIENTE
				AND D2.D_E_L_E_T_ = '' 
			INNER JOIN
				SB1010 B1
				ON D2.D2_COD = B1.B1_COD
				AND B1.D_E_L_E_T_ = '' 
		WHERE
			E1.E1_TIPO = 'NF' 
			AND E1.E1_FILORIG IN ('FG01')
			AND E1.E1_CLIENTE || '-' || E1.E1_LOJA IN ('084500310-0001', '000516169-0001', '004142810-0001', '103333160-0001', '445932640-0001', '220554560-0001', '204771690-0001', '005189690-0001', '042827500-0001')
			AND E1.E1_SITUACA IN ('0', '1', '2', '3', '4', '5', '6', '7', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O')
			AND E1.E1_SALDO <> 0
			AND E1.D_E_L_E_T_ = '') RELD2
	) REL
ORDER BY
	CLI_NOME, LOJA, DOCUMENTO, PARCELA, ITEM, DATA_MOV;

--
/*
	AND E1.E1_PREFIXO BETWEEN '' AND 'ZZZ'
	AND SE1.E1_NUM BETWEEN '' AND 'ZZZ'	
*/